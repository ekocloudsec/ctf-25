FROM gcc:latest

RUN apt-get update && apt-get install -y \
    libcurl4-openssl-dev \
    make \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /build

COPY medicloudx_exporter.c .
COPY Makefile .

ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY

RUN AWS_ACCESS_KEY_ID="$AWS_ACCESS_KEY_ID" AWS_SECRET_ACCESS_KEY="$AWS_SECRET_ACCESS_KEY" make

CMD ["./medicloudx_exporter", "--version"]
